{% extends "exercise.html" %}

{% block exercise_content %}
<h3>{{ question }}</h3>

<div id="MultipleChoice_choicesContainer" class="space-y-3 mb-6">
  {% for choice in answers %}
  <button
      class="w-full text-left border-2 border-gray-300 text-gray-700 py-4 px-6 rounded-lg hover:bg-gray-50 transition"
      onclick="ExerciseMultipleChoice.selectChoice(event, '{{ choice }}')"
      >
      {{ choice }}
  </button>
    {% endfor %}
</div>

<div id="MultipleChoice_result" class="mb-6"></div>

<script>
      const ExerciseMultipleChoice = {
        answered: false,
        correctAnswer: '{{ correct_answer }}',

        selectChoice(event, choice) {
          event.preventDefault();

          if (this.answered) return;

          this.answered = true;
          const button = event.currentTarget;
          const resultDiv = document.getElementById('MultipleChoice_result');
          const choiceButtons = document.querySelectorAll('#MultipleChoice_choicesContainer button');

          // Disable all choice buttons
          choiceButtons.forEach(btn => btn.disabled = true);

          // Highlight correct and incorrect answers
          choiceButtons.forEach(btn => {
            const btnText = btn.textContent.trim();
            if (btnText === this.correctAnswer) {
              btn.classList.remove('border-gray-300');
              btn.classList.add('border-green-500', 'bg-green-100');
            } else if (btnText === choice && choice !== this.correctAnswer) {
              btn.classList.remove('border-gray-300');
              btn.classList.add('border-red-500', 'bg-red-100');
            }
          });

          // Show result message
          if (choice === this.correctAnswer) {
            resultDiv.innerHTML = '<div class="p-4 bg-green-100 text-green-800 rounded-lg">Correct! Well done.</div>';
          } else {
            resultDiv.innerHTML = '<div class="p-4 bg-red-100 text-red-800 rounded-lg">Incorrect. The correct answer is: ' + this.correctAnswer + '</div>';
          }

          // Set the hidden input value
          document.getElementById('Exercise_answerInput').value = choice;

          Exercise.showNextButton();
        }
      };
    </script>
{% endblock %}
